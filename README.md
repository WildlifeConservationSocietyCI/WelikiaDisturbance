# WelikiaDisturbance
Integrated fire, horticulture and pond disturbance model

## Requirements ##
 
#### Python 2.7 + arcpy
ESRI python distribution which contains arcpy library ([WCS license information](https://docs.google.com/document/d/1Mene0tUbbVP063KYKkhCV-sOWz3elkcMEq0bak3vxtE/edit#))

64-bit Background Geoprocessing Python 2.7.10 [MSC v.1500 64 bit (AMD64)]

#### Python Libraries

[numpy‑1.13.1+mkl‑cp27‑cp27m‑win_amd64](http://www.lfd.uci.edu/~gohlke/pythonlibs/#numpy)

[GDAL 2.0.2 x64 bindings](http://www.lfd.uci.edu/~gohlke/pythonlibs/#gdal)

[pywin32-214.win-amd64-py3.0.exe](https://sourceforge.net/projects/pywin32/files/pywin32/Build%20214/)

pandas

scipy

WMI


#### FARSITE
[FARSITE 4.1.055](http://www.firelab.org/document/farsite-software)

#### Initial Model Inputs
[Welikia full extent inputs](https://drive.google.com/open?id=0ByGEknMOH_xMQWhMR04wUEZ2bjQ):
This is the set of data inputs required to run all modules of the disturbance model. 

##### General

  - DEM
  - Ecological communities
  - welikia region boundaries
  - Lenape trails
  - Lenape garden sites
  - welikia_community_translation_table.csv

##### Tree Allometery
  - site_index_curve_table.csv
  - dbh_lookup.csv
  - basal_area_growth_coeffecients.csv

##### Fire Tables
  - custom_fuel.fmd 
  - fuel_adjustment.adj 
  - fuel_moisture.fms 
  - wtr record 
  - wind.wnd 
  - mannahatta-psdi.txt 
  - psdi-years.txt 
  
##### FARSITE Spatial Data
*Refer to FARSITE Setup below on how to generate these files
  - PROJECT.FPJ 
  - LANDSCAPE.LCP 
  
##### Garden Tables
  - welikia_lc_reclass.txt 
  - proximity_reclass.txt 

#### Model Inputs Generated by Script

##### Fire Spatial Data
  - aspect.asc 
  - dem.asc 
  - slope.asc 
  - canopy.asc 
  - fuel.asc 
  - fire_trails.tif 
  - hunting_sites.tif 
  
##### Garden Spatial Data
  - garden_sites.shp 
  - proximity_suitability.tif 
  - slope_suitability.tif 
  
##### Pond Spatial Data
  - dem.tif 
  - flow_direction.tif 
  - stream_suitability.tif 
  

## Disturbances Types

### Fire
This class uses [FARSITE](https://www.firelab.org/project/farsite) to simulate the historical burning regime. Fire spread is modeled by FARSITE and the outputs of burning events are used to calculate tree mortality and update forest age and canopy rasters. Changes to these rasters are then used to modify ecosystem types.

### Beaver Ponds
This class adds beaver disturbance to the landscape, including ponding and pond abandonment. Ponds are created by flooding the DEM at randomly selected dam points. Pond shape is determined by topography (flow direction -> watershed) and dam height (flooding depth). Location of ponds is random along the paths of mapped streams with slopes of eight degrees or less. Density is determined by a minimum territory distance parameter (1000 m).
 
### Horticulture
This class adds and abandons horticultural fields. The general placment of gardens is determined by the location of lenape sites (identified in the ethnohistorical, cartographic, archaeological records) which meet slope and distance to freshwater criteria. At the site scale gardens are positioned based on a horticultural suitability index(slope, ecosystem, proximity to habitation site).

### Ecological Succession
This class updates the growth of forest type communities (DBH, age, tree height) and transitions early succesional communities to advanced states using pathways defined in welikia_community_table_int.csv

## Module Integration 
![alt text](https://github.com/WildlifeConservationSocietyCI/WelikiaDisturbance/blob/master/disturbance_model_notes/figures/succession_disturbance_diagram.png "Logo Title Text 1")

## Setup
 1. Clone WelikiaDistrubance repository 
 2. Download Welikia full extent inputs (welikia_full_extent_inputs) and move to WelikiaDisturbance directory
 3. Set project and log paths in configuration local_settings.py
 4. Run dir_setup.py
 5. Run initiate_disturbance_inputs.py
 6. Create FARSITE PROJECT and LANDSCAPE files manually in FARSITE GUI (refer to FARSITE Setup below)
 7. Configure settings in scenario_settings.py
 8. Run disturbance_script.py
 
## FARSITE Setup
Creating landscape (.LCP) and project (.PRJ) files

*To be done right before running the disturbance script (disturbance_script.py)

After running the initiate disturbance file (initiate_disturbance_inputs.py), 
first create a landscape (.LCP) file using the inputs generated by this script. 

The inputs are ASCII files, which include
- Elevation (dem.asc)
- Slope (slope.asc)
- Aspect (aspect.asc)
- Fuel model (fuel.asc)
- Canopy cover (canopy.asc)

Open FARSITE and from the main menu select **INPUT > LANDSCAPE UTILITES > GENREATE LANDSCAPE FILE**. 
A dialogue box will appear with the option to upload these 5 ASCII files as well as modify the latitude, 
units and options accordingly (should this be left at the default values?). 

Save the landscape file in the same location as the ASCII files (inputs). 
This is important because FARSITE will have issues running if all files are **NOT** in the same directory. 

Next, you will create a project (.PRJ) file using the newly created landscape (.LCP) file 
and initial inputs (Welikia full extent inputs) that include
- Adjustments (fuel_adjustment.adj)
- Moistures (fuel_moisture.fms)
- Custom Models (custom_fuel.fmd)
- Weather Files (weather.wtr)
- Wind Files (wind.wnd)

From the main menu select **INPUT > PROJECT INPUTS**. 
A dialogue box will appear with the option to upload the landscape (.LCP) file and the 5 initial input files.
The rest of the files are optional to upload. 

Save the project file (.PRJ) in the same location as the landscape file (.LCP) 
because FARSITE will have issues running if all files are **NOT** in the same directory. 
 
## TODO (Kim):
- refactor pond until it runs
- refactor fire until it runs
## TODO (Camille):
- code review for setup_refactor PR
- replace inputs_full_extent.zip on google drive with scenario data hierarchy there
- validate initiate from scratch until all outputs look correct in arcgis (path, cellsize, datatype, extent)
- deal with TODOs related to settings and initiate_disturbance
- validate garden
- validate succession
- deal with TODOs related to garden (except TODO at ~288)
- validate pond
- deal with TODOs related to pond
- validate fire
- deal with TODOs related to fire
- (As of 2/12 Kim moved tables from repo to inputs_full_extent; there may be other things to move)
- edit readme
## TODO (future):
- hunt down other sources of script not finishing
- sort out arcpy/gdal/numpy library conflicts definitively
- optimize for efficiency and run time
_ refactor/clean up topographic_exposure, disturbance_model_notes, analysis as necessary
